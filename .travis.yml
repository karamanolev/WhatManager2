language: python
python:
  - "2.7"
services:
  - "mysql"
install:
  - "pip install -r test_requirements.txt"
  - "pip install -r requirements.txt"
  - "./setup_transmission-2.92.sh"
  - "./ci_setup.sh"
  - "mysql -e 'CREATE DATABASE `what_manager2` COLLATE utf8_unicode_ci;'"
  - "cp WhatManager2/settings.example.py WhatManager2/settings.py"
  - "cp qobuz/settings.example.py qobuz/settings.py"
  - "cp qobuz2/settings.example.py qobuz2/settings.py"
  - "cp myanonamouse/settings.example.py myanonamouse/settings.py"
  - "cp bibliotik/settings.example.py bibliotik/settings.py"
  - "./manage.py migrate --noinput"
  - "sudo -- bash -c 'source /home/travis/virtualenv/python2.7/bin/activate && ./manage.py transmission_new --no-confirm redacted.ch'"
  - "sudo -- bash -c 'source /home/travis/virtualenv/python2.7/bin/activate && ./manage.py transmission_new --no-confirm bibliotik.me'"
script:
  - "flake8 ."
  - "./manage.py test"
  - "./test_integration.py"
